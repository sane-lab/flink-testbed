import json
from collections import defaultdict
import re

# Example input data
# key_arrival_rate_str = "{0=0.016482039015553646, 1=0.06959083139900428, 2=0.06775949373060944, 3=0.05127745471505579, 4=0.12636229911924463, 5=0.04028942870468669, 6=0.060434143057030036, 7=0.020144714352343347, 8=0.031132740362712446, 9=0.060434143057030036, 10=0.007325350673579398, 11=0.021976052020738195, 12=0.05494013005184548, 13=0.08057885740937339, 14=0.04028942870468669, 15=0.021976052020738195, 16=0.03845809103629184, 17=0.010988026010369098, 18=0.031132740362712446, 19=0.06226548072542489, 20=0.014650701347158797, 21=0.04028942870468669, 22=0.03296407803110729, 23=0.020144714352343347, 24=0.06226548072542489, 25=0.04761477937826609, 26=0.04761477937826609, 27=0.014650701347158797, 28=0.09156688341974248, 29=0.03296407803110729, 30=0.014650701347158797, 31=0.012819363678763948, 32=0.018313376683948494, 33=0.02747006502592274, 34=0.053108792383450634, 35=0.020144714352343347, 36=0.007325350673579398, 37=0.03662675336789699, 38=0.07325350673579398, 39=0.03845809103629184, 40=0.04395210404147639, 41=0.03479541569950214, 42=0.025638727357527896, 43=0.014650701347158797, 44=0.0018313376683948496, 45=0.029301402694317594, 46=0.12636229911924463, 47=0.009156688341974247, 48=0.029301402694317594, 49=0.04395210404147639, 50=0.14467567580319313, 51=0.05127745471505579, 52=0.02747006502592274, 53=0.03845809103629184, 54=0.020144714352343347, 55=0.03845809103629184, 56=0.03479541569950214, 57=0.060434143057030036, 58=0.15383236414516735, 59=0.04395210404147639, 60=0.023807389689133044, 61=0.04578344170987124, 62=0.06226548072542489, 63=0.03845809103629184, 64=0.014650701347158797, 65=0.04028942870468669, 66=0.06959083139900428, 67=0.09522955875653218, 68=0.04944611704666094, 69=0.031132740362712446, 70=0.06226548072542489, 71=0.07325350673579398, 72=0.03296407803110729, 73=0.020144714352343347, 74=0.02747006502592274, 75=0.031132740362712446, 76=0.010988026010369098, 77=0.07325350673579398, 78=0.021976052020738195, 79=0.023807389689133044, 80=0.020144714352343347, 81=0.014650701347158797, 82=0.007325350673579398, 83=0.05494013005184548, 84=0.03479541569950214, 85=0.02747006502592274, 86=0.018313376683948494, 87=0.021976052020738195, 88=0.005494013005184549, 89=0.04761477937826609, 90=0.04028942870468669, 91=0.014650701347158797, 92=0.005494013005184549, 93=0.07508484440418883, 94=0.010988026010369098, 95=0.060434143057030036, 96=0.053108792383450634, 97=0.04761477937826609, 98=0.025638727357527896, 99=0.14101300046640342, 100=0.009156688341974247, 101=0.08057885740937339, 102=0.07325350673579398, 103=0.05127745471505579, 104=0.029301402694317594, 105=0.04944611704666094, 106=0.020144714352343347, 107=0.04395210404147639, 108=0.014650701347158797, 109=0.06409681839381974, 110=0.025638727357527896, 111=0.03845809103629184, 112=0.04028942870468669, 113=0.03296407803110729, 114=0.03845809103629184, 115=0.04028942870468669, 116=0.012819363678763948, 117=0.03479541569950214, 118=0.03662675336789699, 119=0.04395210404147639, 120=0.03479541569950214, 121=0.04578344170987124, 122=0.06592815606221458, 123=0.018313376683948494, 124=0.020144714352343347, 125=0.0, 126=0.05494013005184548, 127=0.009156688341974247}"
#key_arrival_rate_str = "{0=0.009108674255403511, 1=0.036827034794235186, 2=0.03218600813032793, 3=0.028367371467998417, 4=0.05925535773999285, 5=0.019945422598097125, 6=0.031167180675609148, 7=0.009795399640905733, 8=0.013485699724962438, 9=0.025545041013318587, 10=0.004210974434950646, 11=0.01048212502640795, 12=0.030835078606392584, 13=0.040275854931012656, 14=0.02076048456187215, 15=0.00938786865901822, 16=0.016957041108809016, 17=0.007772937940734548, 18=0.015304395934189866, 19=0.03303878455043843, 20=0.006920161520624049, 21=0.02064734119286572, 22=0.017734388616248563, 23=0.011372615902853926, 24=0.03226143704299888, 25=0.02715997173160226, 26=0.02377925246969301, 27=0.0057127617842278895, 28=0.04303062164448519, 29=0.015674212459741904, 30=0.005675047327892414, 31=0.007418314624448889, 32=0.009403061868284596, 33=0.014429098267010266, 34=0.024262212364251474, 35=0.009886021762843061, 36=0.004784556451446438, 37=0.017266621930956474, 38=0.03496329609086955, 39=0.01645155996718145, 40=0.020383339998517387, 41=0.01628550893257317, 42=0.011184043621176547, 43=0.007176834677169657, 44=0.0012980218583334875, 45=0.012927310917733022, 46=0.06003324238109334, 47=0.006082578309779926, 48=0.011146329164841071, 49=0.019530563578406886, 50=0.0667873528671091, 51=0.022534138276961373, 52=0.015674212459741904, 53=0.021183208753026036, 54=0.012225392322964428, 55=0.020405861245586486, 56=0.02064734119286572, 57=0.031499282744825705, 58=0.07774457261661186, 59=0.023839488173097587, 60=0.01534211039052534, 61=0.026231766398820806, 62=0.029884352026542035, 63=0.018104205141800597, 64=0.005659854118626038, 65=0.01817963405447155, 66=0.035529012935901695, 67=0.044117012840411265, 68=0.02684306287165207, 69=0.01630803017964227, 70=0.028737187993550455, 71=0.03593654391778921, 72=0.014934579408637828, 73=0.010889656008295463, 74=0.012059341288356147, 75=0.01664013224885883, 76=0.004490168838565354, 77=0.0329031199343629, 78=0.00834651995723034, 79=0.009999165131849487, 80=0.009516205237291023, 81=0.006158007222450877, 82=0.0035619635057839026, 83=0.022722710558638753, 84=0.01510063044324611, 85=0.011576381393797682, 86=0.008180468922622062, 87=0.010814227095624511, 88=0.002875238120281683, 89=0.023537772522413777, 90=0.020496483367523813, 91=0.006807018151617621, 92=0.003041289154889963, 93=0.03323522200357946, 94=0.0057127617842278895, 95=0.030065596270416696, 96=0.0260583873264098, 97=0.023628394644351104, 98=0.01251977993584551, 99=0.07066622523284319, 100=0.0030790036112254386, 101=0.036910328878369786, 102=0.033272936459914935, 103=0.023575486978749255, 104=0.01526668147785439, 105=0.0250772743280265, 106=0.010165216166457767, 107=0.022926476049582513, 108=0.00903324534273256, 109=0.032850212268761045, 110=0.012798974339460218, 111=0.020775677771138524, 112=0.023077333874924413, 113=0.01628550893257317, 114=0.01916074705285485, 115=0.022964190505917987, 116=0.008904908764459757, 117=0.018715501614631862, 118=0.01919846150919033, 119=0.023854681382363963, 120=0.01984747243835707, 121=0.026284674064422656, 122=0.029144718975437967, 123=0.00971997072823478, 124=0.009923736219178535, 125=8.904908764459757E-4, 126=0.0277864614136999, 127=0.003969494487671414}"
key_arrival_rate_str = "{0=0.007504051611521651, 1=0.031474578885936716, 2=0.03216051225307036, 3=0.02727247297755203, 4=0.0657814343718338, 5=0.019982648204144454, 6=0.02611483308139882, 7=0.009434130580391328, 8=0.015523062604854278, 9=0.02851661857928806, 10=0.0030444660122314763, 11=0.010591770476544539, 12=0.032761977340464155, 13=0.04172236396599295, 14=0.015352088619531612, 15=0.009691610271296815, 16=0.016081274839456667, 17=0.00767502559684432, 18=0.015008103223043303, 19=0.027871900639102856, 20=0.007118850788084905, 21=0.017624115559046624, 22=0.018995982293313913, 23=0.015008103223043303, 24=0.02834360716812242, 25=0.02594182167023318, 26=0.02182418404158834, 27=0.004844786422726922, 28=0.04883713990239191, 29=0.016765170780747338, 30=0.0057881994807660545, 31=0.007889252434958399, 32=0.011790625799646187, 33=0.01552102517901131, 34=0.028813276271299013, 35=0.01282054456326814, 36=0.00510226611363241, 37=0.01569199916433398, 38=0.033571556988443114, 39=0.014534359268180766, 40=0.022209384865025085, 41=0.020151584763624157, 42=0.010247785080056231, 43=0.00784599958216699, 44=0.0030444660122314763, 45=0.011533146108740698, 46=0.05860914360174263, 47=0.008103479273072478, 48=0.011790625799646187, 49=0.017107118751392675, 50=0.06328295603914688, 51=0.0208375181307578, 52=0.021311262085620335, 53=0.02418475411252914, 54=0.011149982711146922, 55=0.0206685815712781, 56=0.022512154834564955, 57=0.03503400427997917, 58=0.07662864711344086, 59=0.02568637940517066, 60=0.0156095683104371, 61=0.027787432359363005, 62=0.029544499917067042, 63=0.018738502602408426, 64=0.004245358761176097, 65=0.023542073598186906, 66=0.03417913435336582, 67=0.04279553558240631, 68=0.024957193185245606, 69=0.01393696903247291, 70=0.02740223153592626, 71=0.03893741507050993, 72=0.015308835766740202, 73=0.011106729858355514, 74=0.01393696903247291, 75=0.0231980882016986, 76=0.00518877181921523, 77=0.03880561908629273, 78=0.00913339803669443, 79=0.009304372022017098, 80=0.007547304464313061, 81=0.007075597935293495, 82=0.006002426318880133, 83=0.026370275346461334, 84=0.018437770058711528, 85=0.01174941037269775, 86=0.0072898247734075735, 87=0.010033558241942152, 88=0.0025727594832119097, 89=0.0240117427013635, 90=0.01796606352969196, 91=0.00510226611363241, 92=0.002830239174117398, 93=0.031557009739833594, 94=0.004888039275518332, 95=0.029027503109413093, 96=0.029886447887712376, 97=0.021352477512568774, 98=0.010933718447189874, 99=0.07448026645477115, 100=0.003258692850345555, 101=0.04159260540761872, 102=0.03721748808806839, 103=0.02345556789260409, 104=0.012177864048925905, 105=0.022512154834564955, 106=0.011320956696469592, 107=0.025169382597516714, 108=0.009732825698245254, 109=0.027999621771634113, 110=0.009090145183903019, 111=0.021311262085620335, 112=0.026627755037366824, 113=0.010933718447189874, 114=0.017451104147880984, 115=0.020238090469206972, 116=0.009648357418505405, 117=0.018481022911502935, 118=0.01697939761886142, 119=0.025084914317776864, 120=0.02456995493596589, 121=0.0279563689188427, 122=0.028815313697141985, 123=0.009776078551036665, 124=0.012606317725154062, 125=0.0021010529541923436, 126=0.030057421873035048, 127=0.0037303993793651206}"


#key_task_mapping_str = "{c395b989724fa728d0a2640c6ccdb8a1_0=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127]}"
key_task_mapping_str = "{36fcfcb61a35d065e60ee34fccb0541a_0=[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127]}"

# Function to convert the custom formatted string to JSON-compatible format
def convert_to_json_compatible(input_str):
    # Replace = with :
    input_str = input_str.replace("=", ": ")
    # Wrap keys with quotes if they are not already
    input_str = re.sub(r"(\w+):", r'"\1":', input_str)
    # Replace single quotes with double quotes if there are any
    input_str = input_str.replace("'", '"')
    return input_str

# Convert the strings into JSON-compatible format
key_arrival_rate_json = convert_to_json_compatible(key_arrival_rate_str)
key_task_mapping_json = convert_to_json_compatible(key_task_mapping_str)

# Parse the JSON strings into dictionaries
key_arrival_rate = json.loads(key_arrival_rate_json)
key_task_mapping = json.loads(key_task_mapping_json)

# Initialize a dictionary to store the total arrival rate for each task
task_total_arrival_rate = defaultdict(float)

# Compute the total arrival rate for each task
for task, keys in key_task_mapping.items():
    total_rate = sum(key_arrival_rate[str(key)] for key in keys)
    task_total_arrival_rate[task] = total_rate

# Output the total arrival rates for each task
for task, rate in task_total_arrival_rate.items():
    print(f"{task}: {rate}")
print("total arrival: " + str(sum(task_total_arrival_rate.values())))